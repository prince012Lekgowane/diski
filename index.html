<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kele vs Lele - 3D Soccer Showdown</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            overflow: hidden;
            color: white;
            touch-action: none;
        }
        
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
        }
        
        /* MENU SCREENS */
        .menu-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .menu-screen.hidden { display: none; }
        
        .menu-title {
            font-size: clamp(28px, 6vw, 48px);
            font-weight: bold;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }
        
        .menu-subtitle {
            font-size: clamp(14px, 3vw, 20px);
            color: #aaa;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .mode-selection {
            display: flex;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .mode-card {
            background: rgba(255, 255, 255, 0.05);
            border: 3px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            width: 240px;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        .mode-card:hover {
            transform: translateY(-5px);
            border-color: #FFD700;
        }
        
        .mode-card.selected {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.15);
            transform: scale(1.05);
        }
        
        .mode-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .mode-name {
            font-size: 22px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 10px;
        }
        
        .mode-desc {
            font-size: 14px;
            color: #bbb;
        }
        
        .team-selection {
            display: flex;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .team-card {
            background: rgba(255, 255, 255, 0.05);
            border: 3px solid transparent;
            border-radius: 20px;
            padding: 25px;
            width: clamp(220px, 40vw, 280px);
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        .team-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .team-card.selected {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.1);
            transform: scale(1.05);
        }
        
        .team-card.pirates { border-color: #333; }
        .team-card.pirates.selected { border-color: #FFD700; background: rgba(0, 0, 0, 0.3); }
        
        .team-card.sundowns { border-color: #FFD700; }
        .team-card.sundowns.selected { background: rgba(255, 215, 0, 0.2); }
        
        .team-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
        }
        
        .pirates .team-logo {
            background: linear-gradient(135deg, #000 0%, #333 100%);
            border: 3px solid #FFD700;
        }
        
        .sundowns .team-logo {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
        }
        
        .team-name {
            font-size: clamp(20px, 4vw, 28px);
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .team-player {
            font-size: 16px;
            color: #aaa;
            margin-bottom: 15px;
        }
        
        .team-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #FFD700;
        }
        
        .stat-label {
            font-size: 11px;
            color: #888;
        }
        
        .menu-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border: none;
            padding: 15px 40px;
            font-size: clamp(16px, 3vw, 20px);
            font-weight: bold;
            color: #000;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 15px;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }
        
        .menu-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(255, 215, 0, 0.6);
        }
        
        .menu-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .room-input {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #FFD700;
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 18px;
            text-align: center;
            margin: 20px 0;
            width: 100%;
            max-width: 300px;
        }
        
        .room-code-display {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #FFD700;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .room-code-display h3 {
            color: #FFD700;
            margin-bottom: 10px;
        }
        
        .room-code {
            font-size: 32px;
            font-weight: bold;
            color: white;
            letter-spacing: 5px;
        }
        
        .waiting-message {
            font-size: 18px;
            color: #aaa;
            margin: 20px 0;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        /* INSTRUCTIONS */
        .instructions-content {
            max-width: 800px;
            background: rgba(0, 0, 0, 0.7);
            padding: clamp(20px, 4vw, 40px);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .instruction-section {
            margin: 25px 0;
        }
        
        .instruction-section h3 {
            color: #FFD700;
            font-size: clamp(18px, 3vw, 24px);
            margin-bottom: 15px;
        }
        
        .instruction-item {
            display: flex;
            align-items: center;
            margin: 12px 0;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .instruction-key {
            background: #FFD700;
            color: #000;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            margin-right: 15px;
            min-width: 70px;
            text-align: center;
            font-size: clamp(12px, 2vw, 14px);
        }
        
        .instruction-desc {
            flex: 1;
            font-size: clamp(12px, 2vw, 14px);
        }
        
        /* GAME UI */
        #ui {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: clamp(10px, 2vw, 20px);
            border-radius: 15px;
            border: 3px solid #FFD700;
            backdrop-filter: blur(10px);
            z-index: 100;
            text-align: center;
            min-width: clamp(200px, 40vw, 300px);
        }
        
        #score {
            font-size: clamp(18px, 4vw, 32px);
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .score-team {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 8px;
            margin: 0 5px;
        }
        
        .score-pirates {
            background: linear-gradient(45deg, #000, #333);
            border: 2px solid #FFD700;
        }
        
        .score-sundowns {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
        }
        
        #time {
            font-size: clamp(14px, 3vw, 18px);
            color: #FFD700;
            font-weight: bold;
        }
        
        #controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
        }
        
        .control-group {
            display: flex;
            gap: 15px;
        }
        
        .joystick-area {
            width: clamp(100px, 20vw, 140px);
            height: clamp(100px, 20vw, 140px);
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border: 3px solid #FFD700;
            position: relative;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }
        
        .joystick {
            width: 50%;
            height: 50%;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            touch-action: none;
        }
        
        .action-btn {
            width: clamp(70px, 15vw, 90px);
            height: clamp(70px, 15vw, 90px);
            border-radius: 50%;
            background: linear-gradient(45deg, #ff3838, #ff0000);
            border: 3px solid #FFD700;
            color: white;
            font-weight: bold;
            font-size: clamp(12px, 2.5vw, 16px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 30px rgba(255, 56, 56, 0.5);
            transition: transform 0.1s;
            user-select: none;
            touch-action: none;
        }
        
        .action-btn:active {
            transform: scale(0.9);
        }
        
        #power-bar {
            position: absolute;
            bottom: clamp(180px, 30vh, 220px);
            left: 50%;
            transform: translateX(-50%);
            width: clamp(150px, 30vw, 250px);
            height: 12px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            border: 2px solid #FFD700;
            overflow: hidden;
            display: none;
        }
        
        #power-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #ffaa00, #ff0000);
            width: 0%;
            transition: width 0.05s;
        }
        
        #goal-alert {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: clamp(32px, 8vw, 64px);
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 40px rgba(255, 215, 0, 0.9);
            z-index: 1000;
            transition: transform 0.3s;
            padding: clamp(15px, 3vw, 30px);
            border-radius: 20px;
            background-color: rgba(0, 0, 0, 0.9);
            border: 3px solid #FFD700;
            white-space: nowrap;
        }
        
        #stamina-bar {
            position: absolute;
            bottom: clamp(10px, 2vh, 20px);
            left: 50%;
            transform: translateX(-50%);
            width: clamp(150px, 30vw, 200px);
            text-align: center;
        }
        
        .stamina-label {
            font-size: clamp(11px, 2vw, 14px);
            color: #FFD700;
            margin-bottom: 5px;
        }
        
        .stamina-bg {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 5px;
            border: 1px solid #FFD700;
            overflow: hidden;
        }
        
        .stamina-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ffaa00, #00ff00);
            width: 100%;
            transition: width 0.3s;
        }
        
        .pause-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #FFD700;
            color: #FFD700;
            padding: clamp(8px, 1.5vw, 10px) clamp(12px, 2vw, 20px);
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            z-index: 100;
            font-size: clamp(12px, 2vw, 14px);
        }
        
        @media (max-width: 768px) {
            .team-selection { gap: 15px; }
            .instruction-item { 
                flex-direction: column; 
                text-align: center; 
                padding: 10px;
            }
            .instruction-key { margin: 0 0 10px 0; }
        }
        
        @media (max-height: 600px) {
            .menu-screen { justify-content: flex-start; padding-top: 20px; }
            .menu-title { font-size: 24px; margin-bottom: 10px; }
            .menu-subtitle { font-size: 14px; margin-bottom: 15px; }
        }
    </style>
</head>
<body>
    <!-- MODE SELECTION SCREEN -->
    <div id="mode-selection" class="menu-screen">
        <h1 class="menu-title">‚öΩ KELE vs LELE ‚öΩ</h1>
        <p class="menu-subtitle">Choose Your Game Mode</p>
        
        <div class="mode-selection">
            <div class="mode-card" data-mode="single">
                <div class="mode-icon">ü§ñ</div>
                <div class="mode-name">VS AI</div>
                <div class="mode-desc">Play against computer opponent</div>
            </div>
            
            <div class="mode-card" data-mode="multi">
                <div class="mode-icon">üë•</div>
                <div class="mode-name">MULTIPLAYER</div>
                <div class="mode-desc">Play with friend online</div>
            </div>
        </div>
        
        <button class="menu-btn" id="mode-continue-btn" disabled>SELECT A MODE</button>
    </div>
    
    <!-- MULTIPLAYER LOBBY -->
    <div id="multiplayer-lobby" class="menu-screen hidden">
        <h1 class="menu-title">MULTIPLAYER LOBBY</h1>
        
        <div id="lobby-host" style="display: none;">
            <div class="room-code-display">
                <h3>Your Room Code:</h3>
                <div class="room-code" id="room-code-display">----</div>
            </div>
            <p class="waiting-message">Waiting for opponent to join...</p>
        </div>
        
        <div id="lobby-join">
            <p class="menu-subtitle">Enter Room Code:</p>
            <input type="text" class="room-input" id="room-code-input" placeholder="Enter code" maxlength="4">
            <br>
            <button class="menu-btn" id="join-room-btn">JOIN ROOM</button>
            <br>
            <p style="margin: 20px 0; color: #888;">- OR -</p>
            <button class="menu-btn" id="create-room-btn">CREATE ROOM</button>
        </div>
        
        <button class="menu-btn" id="back-to-mode-btn" style="margin-top: 30px; background: rgba(255,255,255,0.1);">‚Üê BACK</button>
    </div>

    <!-- TEAM SELECTION SCREEN -->
    <div id="team-selection" class="menu-screen hidden">
        <h1 class="menu-title">‚öΩ CHOOSE YOUR TEAM ‚öΩ</h1>
        <p class="menu-subtitle">Select Your Player & Team</p>
        
        <div class="team-selection">
            <div class="team-card pirates" data-team="pirates" data-player="kele">
                <div class="team-logo">‚ò†Ô∏è</div>
                <div class="team-name">PIRATES</div>
                <div class="team-player">Kele</div>
                <div class="team-stats">
                    <div class="stat">
                        <div class="stat-value">85</div>
                        <div class="stat-label">Speed</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">90</div>
                        <div class="stat-label">Shooting</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">80</div>
                        <div class="stat-label">Control</div>
                    </div>
                </div>
            </div>
            
            <div class="team-card sundowns" data-team="sundowns" data-player="lele">
                <div class="team-logo">‚òÄÔ∏è</div>
                <div class="team-name">SUNDOWNS</div>
                <div class="team-player">Lele</div>
                <div class="team-stats">
                    <div class="stat">
                        <div class="stat-value">88</div>
                        <div class="stat-label">Speed</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">85</div>
                        <div class="stat-label">Shooting</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">92</div>
                        <div class="stat-label">Control</div>
                    </div>
                </div>
            </div>
        </div>
        
        <button class="menu-btn" id="start-btn" disabled>SELECT A TEAM</button>
    </div>
    
    <!-- INSTRUCTIONS SCREEN -->
    <div id="instructions-screen" class="menu-screen hidden">
        <div class="instructions-content">
            <h1 class="menu-title">HOW TO PLAY</h1>
            
            <div class="instruction-section">
                <h3>üéÆ Desktop Controls</h3>
                <div class="instruction-item">
                    <div class="instruction-key">W A S D</div>
                    <div class="instruction-desc">Move your player around the pitch</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-key">SPACE</div>
                    <div class="instruction-desc">Hold to charge power, release to shoot/pass</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-key">MOUSE</div>
                    <div class="instruction-desc">Drag to rotate camera view</div>
                </div>
            </div>
            
            <div class="instruction-section">
                <h3>üì± Mobile Controls</h3>
                <div class="instruction-item">
                    <div class="instruction-key">JOYSTICK</div>
                    <div class="instruction-desc">Drag the left joystick to move</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-key">SHOOT</div>
                    <div class="instruction-desc">Hold the red button to charge, release to shoot</div>
                </div>
            </div>
            
            <div class="instruction-section">
                <h3>‚öΩ Game Rules</h3>
                <div class="instruction-item">
                    <div class="instruction-desc">‚Ä¢ Score more goals than your opponent in 90 seconds</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-desc">‚Ä¢ Watch your stamina bar - it drains when moving and shooting</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-desc">‚Ä¢ Hold shoot button longer for more powerful shots</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-desc">‚Ä¢ Get close to the ball to control and kick it</div>
                </div>
            </div>
            
            <button class="menu-btn" id="play-btn">LET'S PLAY! ‚öΩ</button>
        </div>
    </div>
    
    <!-- GAME CONTAINER -->
    <div id="game-container"></div>
    
    <!-- GAME UI -->
    <div id="ui" style="display: none;">
        <div id="score">
            <span class="score-team score-pirates">Pirates 0</span>
            :
            <span class="score-team score-sundowns">Sundowns 0</span>
        </div>
        <div id="time">‚è±Ô∏è 1:30</div>
    </div>
    
    <button class="pause-btn" style="display: none;">‚è∏Ô∏è PAUSE</button>
    
    <div id="goal-alert">GOAL!</div>
    <div id="power-bar"><div id="power-fill"></div></div>
    
    <div id="stamina-bar" style="display: none;">
        <div class="stamina-label">STAMINA</div>
        <div class="stamina-bg">
            <div class="stamina-fill"></div>
        </div>
    </div>
    
    <div id="controls" style="display: none;">
        <div class="control-group">
            <div class="joystick-area" id="joystick-area">
                <div class="joystick" id="joystick"></div>
            </div>
        </div>
        
        <div class="control-group">
            <div class="action-btn" id="shoot-btn">SHOOT</div>
        </div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/"
        }
    }
    </script>
    
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        
        // MULTIPLAYER STATE
        let gameMode = null;
        let isMultiplayer = false;
        let roomCode = null;
        let isHost = false;
        let gameData = null;
        
        // Simple P2P using localStorage for demo (replace with WebSocket/Firebase for production)
        const MultiplayerManager = {
            createRoom() {
                roomCode = Math.random().toString(36).substring(2, 6).toUpperCase();
                isHost = true;
                localStorage.setItem(`room_${roomCode}`, JSON.stringify({
                    host: true,
                    hostTeam: null,
                    guestTeam: null,
                    hostReady: false,
                    guestReady: false,
                    gameState: null
                }));
                return roomCode;
            },
            
            joinRoom(code) {
                const room = localStorage.getItem(`room_${code}`);
                if (room) {
                    roomCode = code;
                    isHost = false;
                    return true;
                }
                return false;
            },
            
            updateRoom(data) {
                if (!roomCode) return;
                const room = JSON.parse(localStorage.getItem(`room_${roomCode}`) || '{}');
                Object.assign(room, data);
                localStorage.setItem(`room_${roomCode}`, JSON.stringify(room));
            },
            
            getRoom() {
                if (!roomCode) return null;
                return JSON.parse(localStorage.getItem(`room_${roomCode}`) || 'null');
            },
            
            watchRoom(callback) {
                if (!roomCode) return;
                setInterval(() => {
                    const room = this.getRoom();
                    if (room) callback(room);
                }, 100);
            }
        };
        
        // GAME STATE
        let selectedTeam = null;
        let selectedPlayer = null;
        let gameStarted = false;
        
        const gameState = {
            score: { pirates: 0, sundowns: 0 },
            time: 90,
            isPlaying: false,
            powerShot: 0,
            isCharging: false,
            playerStamina: 100,
            aiStamina: 100
        };
        
        // MODE SELECTION
        document.querySelectorAll('.mode-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                
                gameMode = this.dataset.mode;
                isMultiplayer = gameMode === 'multi';
                
                document.getElementById('mode-continue-btn').disabled = false;
                document.getElementById('mode-continue-btn').textContent = 'CONTINUE';
            });
        });
        
        document.getElementById('mode-continue-btn').addEventListener('click', () => {
            if (gameMode === 'single') {
                document.getElementById('mode-selection').classList.add('hidden');
                document.getElementById('team-selection').classList.remove('hidden');
            } else if (gameMode === 'multi') {
                document.getElementById('mode-selection').classList.add('hidden');
                document.getElementById('multiplayer-lobby').classList.remove('hidden');
            }
        });
        
        // MULTIPLAYER LOBBY
        document.getElementById('create-room-btn').addEventListener('click', () => {
            const code = MultiplayerManager.createRoom();
            document.getElementById('room-code-display').textContent = code;
            document.getElementById('lobby-join').style.display = 'none';
            document.getElementById('lobby-host').style.display = 'block';
            
            MultiplayerManager.watchRoom((room) => {
                if (room.guestTeam && room.hostTeam) {
                                        document.getElementById('lobby-host').innerHTML = '<p class="menu-subtitle">Opponent joined! Ready to start...</p>';
                    setTimeout(() => {
                        document.getElementById('multiplayer-lobby').classList.add('hidden');
                        document.getElementById('team-selection').classList.remove('hidden');
                    }, 1000);
                }
            });
        });
        
        document.getElementById('join-room-btn').addEventListener('click', () => {
            const code = document.getElementById('room-code-input').value.toUpperCase();
            if (MultiplayerManager.joinRoom(code)) {
                roomCode = code;
                document.getElementById('multiplayer-lobby').innerHTML = `
                    <h1 class="menu-title">JOINED ROOM</h1>
                    <p class="menu-subtitle">Waiting for host to start...</p>
                    <div class="room-code-display">
                        <h3>Room Code:</h3>
                        <div class="room-code">${code}</div>
                    </div>
                `;
                
                MultiplayerManager.watchRoom((room) => {
                    if (room.gameState === 'starting') {
                        document.getElementById('multiplayer-lobby').classList.add('hidden');
                        document.getElementById('team-selection').classList.remove('hidden');
                    }
                });
            } else {
                alert('Invalid room code!');
            }
        });
        
        document.getElementById('back-to-mode-btn').addEventListener('click', () => {
            document.getElementById('multiplayer-lobby').classList.add('hidden');
            document.getElementById('mode-selection').classList.remove('hidden');
        });
        
        // TEAM SELECTION
        document.querySelectorAll('.team-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.team-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                
                selectedTeam = this.dataset.team;
                selectedPlayer = this.dataset.player;
                
                document.getElementById('start-btn').disabled = false;
                document.getElementById('start-btn').textContent = 'CONTINUE';
                
                if (isMultiplayer && roomCode) {
                    MultiplayerManager.updateRoom({
                        [isHost ? 'hostTeam' : 'guestTeam']: selectedTeam
                    });
                }
            });
        });
        
        document.getElementById('start-btn').addEventListener('click', () => {
            if (isMultiplayer) {
                if (isHost) {
                    MultiplayerManager.updateRoom({ gameState: 'starting' });
                }
            }
            document.getElementById('team-selection').classList.add('hidden');
            document.getElementById('instructions-screen').classList.remove('hidden');
        });
        
        document.getElementById('play-btn').addEventListener('click', () => {
            document.getElementById('instructions-screen').classList.add('hidden');
            startGame();
        });
        
        // GAME INITIALIZATION
        let scene, camera, renderer, controls;
        let field, ball, player, aiPlayer, goals = [];
        let playerMesh, aiMesh, ballMesh;
        let fieldSize = { width: 40, height: 20 };
        let keys = {};
        let isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        let joystickActive = false;
        let joystickVector = new THREE.Vector2();
        
        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);
            
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 15, 25);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('game-container').appendChild(renderer.domElement);
            
            if (!isMobile) {
                controls = new OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.minDistance = 10;
                controls.maxDistance = 50;
                controls.maxPolarAngle = Math.PI / 2;
            }
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Create field
            createField();
            
            // Create goals
            createGoals();
            
            // Create ball
            createBall();
            
            // Create players
            createPlayers();
            
            // Setup controls
            setupControls();
            
            // Start game loop
            animate();
        }
        
        function createField() {
            // Grass
            const grassGeometry = new THREE.PlaneGeometry(fieldSize.width, fieldSize.height);
            const grassMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x2e7d32,
                side: THREE.DoubleSide
            });
            field = new THREE.Mesh(grassGeometry, grassMaterial);
            field.rotation.x = -Math.PI / 2;
            field.receiveShadow = true;
            scene.add(field);
            
            // Field markings
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0xffffff });
            
            // Center circle
            const centerCircle = new THREE.RingGeometry(2, 2.1, 32);
            const centerCircleMesh = new THREE.Mesh(centerCircle, new THREE.MeshBasicMaterial({ 
                color: 0xffffff,
                side: THREE.DoubleSide
            }));
            centerCircleMesh.rotation.x = Math.PI / 2;
            scene.add(centerCircleMesh);
            
            // Center line
            const centerLine = new THREE.Line(
                new THREE.BufferGeometry().setFromPoints([
                    new THREE.Vector3(0, 0.1, -fieldSize.height/2),
                    new THREE.Vector3(0, 0.1, fieldSize.height/2)
                ]),
                lineMaterial
            );
            scene.add(centerLine);
        }
        
        function createGoals() {
            const goalGeometry = new THREE.BoxGeometry(3, 2, 0.5);
            const goalMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            
            // Left goal (Pirates)
            const leftGoal = new THREE.Mesh(goalGeometry, goalMaterial);
            leftGoal.position.set(0, 1, -fieldSize.height/2 - 0.25);
            leftGoal.castShadow = true;
            scene.add(leftGoal);
            goals.push({ mesh: leftGoal, team: 'sundowns' });
            
            // Right goal (Sundowns)
            const rightGoal = new THREE.Mesh(goalGeometry, goalMaterial);
            rightGoal.position.set(0, 1, fieldSize.height/2 + 0.25);
            rightGoal.castShadow = true;
            scene.add(rightGoal);
            goals.push({ mesh: rightGoal, team: 'pirates' });
        }
        
        function createBall() {
            const ballGeometry = new THREE.SphereGeometry(0.3, 32, 32);
            const ballMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xffffff,
                shininess: 100
            });
            ballMesh = new THREE.Mesh(ballGeometry, ballMaterial);
            ballMesh.castShadow = true;
            ballMesh.position.set(0, 0.3, 0);
            scene.add(ballMesh);
            
            ball = {
                mesh: ballMesh,
                velocity: new THREE.Vector3(0, 0, 0),
                position: new THREE.Vector3(0, 0.3, 0),
                friction: 0.98,
                gravity: -0.01
            };
        }
        
        function createPlayers() {
            const playerGeometry = new THREE.CapsuleGeometry(0.5, 1.5, 8, 16);
            
            // Player (Kele or Lele based on selection)
            const playerMaterial = new THREE.MeshPhongMaterial({ 
                color: selectedTeam === 'pirates' ? 0x000000 : 0xFFD700
            });
            playerMesh = new THREE.Mesh(playerGeometry, playerMaterial);
            playerMesh.castShadow = true;
            playerMesh.position.set(-5, 1, 0);
            scene.add(playerMesh);
            
            player = {
                mesh: playerMesh,
                velocity: new THREE.Vector3(0, 0, 0),
                speed: selectedTeam === 'pirates' ? 0.15 : 0.14,
                stamina: 100,
                hasBall: false,
                team: selectedTeam,
                shootPower: 0
            };
            
            // AI Opponent
            const aiMaterial = new THREE.MeshPhongMaterial({ 
                color: selectedTeam === 'pirates' ? 0xFFD700 : 0x000000
            });
            aiMesh = new THREE.Mesh(playerGeometry, aiMaterial);
            aiMesh.castShadow = true;
            aiMesh.position.set(5, 1, 0);
            scene.add(aiMesh);
            
            aiPlayer = {
                mesh: aiMesh,
                velocity: new THREE.Vector3(0, 0, 0),
                speed: selectedTeam === 'pirates' ? 0.13 : 0.12,
                stamina: 100,
                hasBall: false,
                team: selectedTeam === 'pirates' ? 'sundowns' : 'pirates',
                target: new THREE.Vector3(0, 0, 0)
            };
        }
        
        function setupControls() {
            // Keyboard controls
            window.addEventListener('keydown', (e) => {
                keys[e.key.toLowerCase()] = true;
                if (e.key === ' ' && !gameState.isCharging) {
                    startCharging();
                }
            });
            
            window.addEventListener('keyup', (e) => {
                keys[e.key.toLowerCase()] = false;
                if (e.key === ' ' && gameState.isCharging) {
                    shoot();
                }
            });
            
            // Mobile controls
            if (isMobile) {
                const joystick = document.getElementById('joystick');
                const joystickArea = document.getElementById('joystick-area');
                const shootBtn = document.getElementById('shoot-btn');
                
                let joystickStart = null;
                
                joystickArea.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    joystickStart = {
                        x: e.touches[0].clientX,
                        y: e.touches[0].clientY
                    };
                    joystickActive = true;
                });
                
                document.addEventListener('touchmove', (e) => {
                    if (!joystickStart || !joystickActive) return;
                    
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - joystickStart.x;
                    const deltaY = touch.clientY - joystickStart.y;
                    
                    const distance = Math.min(Math.sqrt(deltaX * deltaX + deltaY * deltaY), 50);
                    const angle = Math.atan2(deltaY, deltaX);
                    
                    joystickVector.set(
                        Math.cos(angle) * (distance / 50),
                        Math.sin(angle) * (distance / 50)
                    );
                    
                    // Move joystick visual
                    joystick.style.transform = `translate(calc(-50% + ${deltaX}px), calc(-50% + ${deltaY}px))`;
                });
                
                document.addEventListener('touchend', (e) => {
                    joystickActive = false;
                    joystickVector.set(0, 0);
                    joystick.style.transform = 'translate(-50%, -50%)';
                    joystickStart = null;
                });
                
                shootBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    startCharging();
                });
                
                shootBtn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    if (gameState.isCharging) {
                        shoot();
                    }
                });
            }
            
            // Update UI elements
            document.querySelector('.pause-btn').addEventListener('click', togglePause);
        }
        
        function startCharging() {
            if (!player.hasBall || gameState.playerStamina < 10) return;
            
            gameState.isCharging = true;
            document.getElementById('power-bar').style.display = 'block';
            
            const chargeInterval = setInterval(() => {
                if (gameState.isCharging) {
                    gameState.powerShot = Math.min(gameState.powerShot + 2, 100);
                    document.getElementById('power-fill').style.width = gameState.powerShot + '%';
                    
                    // Drain stamina while charging
                    gameState.playerStamina = Math.max(0, gameState.playerStamina - 0.5);
                    updateStaminaBar();
                    
                    if (gameState.powerShot >= 100) {
                        clearInterval(chargeInterval);
                        shoot();
                    }
                } else {
                    clearInterval(chargeInterval);
                }
            }, 50);
        }
        
        function shoot() {
            if (!gameState.isCharging || !player.hasBall) return;
            
            gameState.isCharging = false;
            document.getElementById('power-bar').style.display = 'none';
            
            // Calculate shoot direction
            const shootPower = gameState.powerShot / 20;
            const direction = new THREE.Vector3();
            camera.getWorldDirection(direction);
            direction.y = 0.3; // Add some upward angle
            direction.normalize();
            
            ball.velocity.copy(direction.multiplyScalar(shootPower));
            player.hasBall = false;
            
            // Drain stamina for shooting
            gameState.playerStamina = Math.max(0, gameState.playerStamina - (gameState.powerShot / 5));
            updateStaminaBar();
            
            gameState.powerShot = 0;
        }
        
        function updateStaminaBar() {
            document.querySelector('.stamina-fill').style.width = gameState.playerStamina + '%';
        }
        
        function togglePause() {
            gameState.isPlaying = !gameState.isPlaying;
            document.querySelector('.pause-btn').textContent = gameState.isPlaying ? '‚è∏Ô∏è PAUSE' : '‚ñ∂Ô∏è RESUME';
        }
        
        function startGame() {
            document.getElementById('game-container').style.display = 'block';
            document.getElementById('ui').style.display = 'block';
            document.getElementById('stamina-bar').style.display = 'block';
            document.querySelector('.pause-btn').style.display = 'block';
            
            if (isMobile) {
                document.getElementById('controls').style.display = 'flex';
            }
            
            gameState.isPlaying = true;
            init();
            startGameTimer();
        }
        
        function startGameTimer() {
            const timerInterval = setInterval(() => {
                if (gameState.isPlaying) {
                    gameState.time--;
                    
                    const minutes = Math.floor(gameState.time / 60);
                    const seconds = gameState.time % 60;
                    document.getElementById('time').textContent = 
                        `‚è±Ô∏è ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (gameState.time <= 0) {
                        clearInterval(timerInterval);
                        endGame();
                    }
                }
            }, 1000);
        }
        
        function updateAI() {
            if (!gameState.isPlaying) return;
            
            // Simple AI logic
            const ballPos = ball.position;
            const aiPos = aiPlayer.mesh.position;
            
            // Calculate distance to ball
            const distanceToBall = aiPos.distanceTo(ballPos);
            
            if (aiPlayer.hasBall) {
                // AI has ball - move towards opponent's goal and shoot
                const targetGoal = goals.find(g => g.team === player.team).mesh.position;
                const direction = new THREE.Vector3().subVectors(targetGoal, aiPos);
                direction.y = 0;
                direction.normalize();
                
                aiPlayer.velocity.copy(direction.multiplyScalar(aiPlayer.speed * 0.8));
                
                // Randomly shoot when close to goal
                if (distanceToBall < 10 && Math.random() < 0.02 && gameState.aiStamina > 20) {
                    const shootDir = new THREE.Vector3().subVectors(targetGoal, aiPos).normalize();
                    ball.velocity.copy(shootDir.multiplyScalar(1.5));
                    aiPlayer.hasBall = false;
                    gameState.aiStamina = Math.max(0, gameState.aiStamina - 20);
                }
            } else {
                // AI doesn't have ball - chase ball
                const direction = new THREE.Vector3().subVectors(ballPos, aiPos);
                direction.y = 0;
                
                if (distanceToBall > 0.5) {
                    direction.normalize();
                    aiPlayer.velocity.copy(direction.multiplyScalar(aiPlayer.speed));
                    
                    // Try to steal ball from player
                    if (distanceToBall < 1.5 && player.hasBall && Math.random() < 0.05) {
                        player.hasBall = false;
                        aiPlayer.hasBall = true;
                        ball.velocity.set(0, 0, 0);
                    }
                } else {
                    aiPlayer.velocity.set(0, 0, 0);
                    aiPlayer.hasBall = true;
                    ball.position.copy(aiPos.clone().add(new THREE.Vector3(0, 0, 1)));
                }
            }
            
            // Update AI stamina
            if (aiPlayer.velocity.length() > 0) {
                gameState.aiStamina = Math.max(0, gameState.aiStamina - 0.1);
            } else {
                gameState.aiStamina = Math.min(100, gameState.aiStamina + 0.2);
            }
            
            // Apply velocity
            aiPos.add(aiPlayer.velocity);
            
            // Boundary check
            aiPos.x = Math.max(-fieldSize.width/2 + 1, Math.min(fieldSize.width/2 - 1, aiPos.x));
            aiPos.z = Math.max(-fieldSize.height/2 + 1, Math.min(fieldSize.height/2 - 1, aiPos.z));
        }
        
        function updatePlayer() {
            if (!gameState.isPlaying) return;
            
            const playerPos = player.mesh.position;
            let moveVector = new THREE.Vector3();
            
            if (isMobile && joystickActive) {
                // Mobile joystick movement
                moveVector.set(joystickVector.x, 0, -joystickVector.y);
            } else {
                // Keyboard movement
                if (keys['w'] || keys['arrowup']) moveVector.z -= 1;
                if (keys['s'] || keys['arrowdown']) moveVector.z += 1;
                if (keys['a'] || keys['arrowleft']) moveVector.x -= 1;
                if (keys['d'] || keys['arrowright']) moveVector.x += 1;
            }
            
            if (moveVector.length() > 0) {
                moveVector.normalize();
                
                // Rotate movement vector based on camera direction
                if (!isMobile) {
                    const cameraDirection = new THREE.Vector3();
                    camera.getWorldDirection(cameraDirection);
                    cameraDirection.y = 0;
                    cameraDirection.normalize();
                    
                    const angle = Math.atan2(cameraDirection.x, cameraDirection.z);
                    moveVector.applyAxisAngle(new THREE.Vector3(0, 1, 0), angle);
                }
                
                player.velocity.copy(moveVector.multiplyScalar(player.speed));
                
                // Drain stamina while moving
                gameState.playerStamina = Math.max(0, gameState.playerStamina - 0.2);
            } else {
                player.velocity.set(0, 0, 0);
                // Recover stamina when not moving
                gameState.playerStamina = Math.min(100, gameState.playerStamina + 0.5);
            }
            
            // Apply velocity with stamina effect
            const staminaMultiplier = gameState.playerStamina > 20 ? 1 : 0.5;
            playerPos.add(player.velocity.multiplyScalar(staminaMultiplier));
            
            // Boundary check
            playerPos.x = Math.max(-fieldSize.width/2 + 1, Math.min(fieldSize.width/2 - 1, playerPos.x));
            playerPos.z = Math.max(-fieldSize.height/2 + 1, Math.min(fieldSize.height/2 - 1, playerPos.z));
            
            // Check ball possession
            const distanceToBall = playerPos.distanceTo(ball.position);
            if (distanceToBall < 1.5 && !aiPlayer.hasBall) {
                player.hasBall = true;
                ball.velocity.set(0, 0, 0);
                
                // Position ball in front of player
                const ballOffset = new THREE.Vector3(0, 0, 1);
                if (!isMobile) {
                    const cameraDirection = new THREE.Vector3();
                    camera.getWorldDirection(cameraDirection);
                    cameraDirection.y = 0;
                    cameraDirection.normalize();
                    ballOffset.applyAxisAngle(new THREE.Vector3(0, 1, 0), 
                        Math.atan2(cameraDirection.x, cameraDirection.z));
                }
                
                ball.position.copy(playerPos.clone().add(ballOffset));
                ball.position.y = 0.3;
            }
            
            updateStaminaBar();
        }
        
        function updateBall() {
            if (!gameState.isPlaying) return;
            
            // Apply velocity
            ball.position.add(ball.velocity);
            
            // Apply friction
            ball.velocity.multiplyScalar(ball.friction);
            
            // Apply gravity
            ball.velocity.y += ball.gravity;
            
            // Bounce on ground
            if (ball.position.y <= 0.3) {
                ball.position.y = 0.3;
                ball.velocity.y *= -0.7; // Bounce with energy loss
            }
            
            // Boundary collision
            if (Math.abs(ball.position.x) > fieldSize.width/2) {
                ball.position.x = Math.sign(ball.position.x) * (fieldSize.width/2 - 0.5);
                ball.velocity.x *= -0.8;
            }
            
            if (Math.abs(ball.position.z) > fieldSize.height/2) {
                ball.position.z = Math.sign(ball.position.z) * (fieldSize.height/2 - 0.5);
                ball.velocity.z *= -0.8;
            }
            
            // Check for goals
            checkGoals();
        }
        
        function checkGoals() {
            const ballPos = ball.position;
            
            for (const goal of goals) {
                const goalPos = goal.mesh.position;
                const distance = ballPos.distanceTo(goalPos);
                
                if (distance < 2 && ballPos.z * goalPos.z > 0) { // Ball is in front of goal
                    if (Math.abs(ballPos.x) < 1.5 && ballPos.y < 2) { // Ball is within goal dimensions
                        scoreGoal(goal.team);
                        resetBall();
                        return;
                    }
                }
            }
        }
        
        function scoreGoal(scoringTeam) {
            gameState.score[scoringTeam]++;
            
            // Update score display
            document.getElementById('score').innerHTML = `
                <span class="score-team score-pirates">Pirates ${gameState.score.pirates}</span>
                :
                <span class="score-team score-sundowns">Sundowns ${gameState.score.sundowns}</span>
            `;
            
            // Show goal alert
            const goalAlert = document.getElementById('goal-alert');
            goalAlert.style.transform = 'translate(-50%, -50%) scale(1)';
            goalAlert.style.backgroundColor = scoringTeam === 'pirates' ? 'rgba(0,0,0,0.9)' : 'rgba(255,215,0,0.2)';
            
            setTimeout(() => {
                goalAlert.style.transform = 'translate(-50%, -50%) scale(0)';
            }, 2000);
        }
        
        function resetBall() {
            ball.position.set(0, 0.3, 0);
            ball.velocity.set(0, 0, 0);
            player.hasBall = false;
            aiPlayer.hasBall = false;
            
            // Reset player positions
            player.mesh.position.set(-5, 1, 0);
            aiPlayer.mesh.position.set(5, 1, 0);
        }
        
        function endGame() {
            gameState.isPlaying = false;
            
            const winner = gameState.score.pirates > gameState.score.sundowns ? 'PIRATES' : 
                          gameState.score.pirates < gameState.score.sundowns ? 'SUNDOWNS' : 'DRAW';
            
            setTimeout(() => {
                alert(`GAME OVER!\n\nFinal Score:\nPirates: ${gameState.score.pirates}\nSundowns: ${gameState.score.sundowns}\n\n${winner === 'DRAW' ? "It's a draw!" : `${winner} WIN!`}`);
                
                // Reset game
                document.getElementById('game-container').style.display = 'none';
                document.getElementById('ui').style.display = 'none';
                document.getElementById('stamina-bar').style.display = 'none';
                document.querySelector('.pause-btn').style.display = 'none';
                document.getElementById('controls').style.display = 'none';
                
                // Return to mode selection
                document.getElementById('mode-selection').classList.remove('hidden');
            }, 1000);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (gameState.isPlaying) {
                updatePlayer();
                updateAI();
                updateBall();
                
                // Update ball mesh position
                ball.mesh.position.copy(ball.position);
                
                // Update player rotation to face movement direction
                if (player.velocity.length() > 0.01) {
                    player.mesh.lookAt(player.mesh.position.clone().add(player.velocity));
                }
                
                // Update AI rotation
                if (aiPlayer.velocity.length() > 0.01) {
                    aiPlayer.mesh.lookAt(aiPlayer.mesh.position.clone().add(aiPlayer.velocity));
                }
            }
            
            if (!isMobile && controls) {
                controls.update();
            }
            
            renderer.render(scene, camera);
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Prevent context menu on mobile
        document.addEventListener('contextmenu', (e) => e.preventDefault());
    </script>
</body>
</html>
